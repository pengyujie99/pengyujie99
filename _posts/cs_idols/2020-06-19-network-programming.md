---
title: "Network Programming"
date:  2020-06-19 12:00:00
subtitle: "了解网络编程"
layout: post
author: "Pengyujie"
tags:
  - 笔记
  - 基础
  - 网络编程
---

>HTTP与HTTPS的关系？访问一个网站的过程？DNS？...



## 初识网络编程

在学习Java网络编程之前，我们先来了解什么是计算机网络。

计算机网络是指两台或更多的计算机组成的网络，在同一个网络中，任意两台计算机都可以直接通信，因为所有计算机都需要遵循同一种网络协议。

那什么是互联网呢？

互联网是网络的网络（internet），即把很多计算机网络连接起来，形成一个全球统一的互联网。

**定位到一个服务**

- 定位到一个主机（计算机）：IP地址  

- 定位到一个程序应用的进程：port  

通过一个IP地址和port（**IP:Port**）就可以定位到世界上的任意一台电脑正在运行的服务。每一台电脑的port端口号 不可冲突 0-65535个端口号  。

IP地址 分类 IPV4/IPV6  IPV4很早便被分配完了。  

IPV4：127.0.0.1    0-255  

IPV6：fe80::e52d:e74f:c6b6:43cf%15  128位  

```
ABC类地址
1.0.0.1 -A类- 128.0.0.1 -B类-  192.0.0.1  -C类-
```



OSI 七层：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层

TCP/IP 四层：应用层、传输层、网络层、网络接口层





#### 局域网

如果两台计算机位于同一个网络，那么他们之间可以直接通信，因为他们的**IP地址前段是相同的**，也就是网络号是相同的。网络号是IP地址通过子网掩码过滤后得到的。

255.255.0.1/16 	#16表示的是前面二位相同就是在同一网络 如果是24 表示的是前面三位相同就是在同一网络，可以写成00000000 .00000000 .00000000 .00000000

此时只要前二位相同255.255.0.1 - 255.255.255.254  有65533（256*256-2）个可以分配的地址

如果是255.255.0.1/24

要前三位相同255.255.0.1 - 255.255.0.254  有254（256-2）个可以分配的地址



#### 通信协议

TCP/IP协议泛指互联网协议，其中最重要的两个协议是TCP协议和IP协议。只有使用TCP/IP协议的计算机才能够联入互联网，使用其他网络协议（例如NetBIOS、AppleTalk协议等）是无法联入互联网的。

TCP/IP协议簇  TCP/IP协议又叫网络通讯协议 它包括了TCP、IP、UDP、FTP、SMTP等许多协议。  

TCP协议对应传输层，IP协议对应网络层，HTTP协议对应应用层 http是无状态的通信协议。

RPC协议是指远程过程调用，指一种进程间的通信方式，它允许程序调用另一个地址空间（另一个主机）的过程或函数。RPC指的是跨网络实现的远程调用。可以跨语言实现。



我们常说的socket编程又是什么意思？  

socket并不是一个协议，它只是封装了TCP/IP协议，它是一组调用TCP/IP协议的API函数。  

是进行socket网络编程调用的一组接口。



## 访问一个网站
```
用户访问一个网站，输入其域名进访问，首先在自身缓存中查看有没有解析过这个域名，有则返回，
没有则通过DNS解析，计算机的DNS（这个DNS可以自己设置，在C盘的hosts的文件），相当于一个邮
局，你将你所需要的连接的网站的域名给它，由他进行解析返回给你IP地址。这时候你就可以访问了
```
访问一个网站的过程：

1、输入一个域名；回车

2、电脑会先检查本机的hosts配置文件下，有没有这个域名的映射，

- 有则直接返回对应的映射IP地址去访问
- 没有就回去DNS服务器找，找到就会根据找到的IP地址去访问，没有就返回没找到



注意：如果你的DNS不靠谱可能会返回给你，错的IP地址，比如你访问淘宝，可能最后返回了你京东的IP地址。



### 修改Hosts文件

**linux**

- `/etc/hosts`: ip -> 域名
- `/etc/resolv.conf`: 设置dns服务器ip地址
- `/etc/host.conf`: 制定域名解析顺序（本地hosts文件，dns解析)

**win**

- `C:\Windows\System32\drivers\etc\hosts`: ip -> 域名
- dns: 控制面板 -> 网络和共享中心 -> 以太网 -> 属性 -> ipv4 -> dns




## HTTP和HTTPS
HTTP缺点：

- 请求信息明文传输，容易被窃听截取。
- 数据的完整性未校验，容易被篡改
- 没有验证对方身份，存在冒充危险



HTTPS缺点：

- HTTPS协议多次握手，导致页面的加载时间延长近50%；
- HTTPS连接缓存不如HTTP高效，会增加数据开销和功耗；
- 申请SSL证书需要钱，功能越强大的证书费用越高。
- SSL涉及到的安全算法会消耗 CPU 资源，对服务器资源消耗较大。

```shell
事实上个人理解就是，HTTPS是在HTTP协议的基础上加了SSL协议，变得更为安全，同时SSL认证通常是需要购买的，
尤其是一些大型网站，淘宝之类的，购买的金额更是恐怖，使用了SSL协议之后速度也要慢一点。
HTTP是通过明文传输数据，很容易被不法分子进行抓包，然后修改其中数据。HTTPS相当于HTTP协议的安全版本。
```


```
HTTPS
1.首先客户端通过URL访问服务器建立SSL连接。
2.服务端收到客户端请求后，会将网站支持的证书信息（证书中包含公钥）传送一份给客户端。
3.客户端从证书中提取公钥并生成一个主秘钥MS。然后客户端使用公钥对其进行加密，发送给服务器。
4.服务器利用自己的私钥解密出主秘钥MS。
5.服务器利用主秘钥MS加密与客户端之间的通信。
```
区别：  

HTTPS是HTTP协议的安全版本，HTTP协议的数据传输是明文的，是不安全的，HTTPS使用了SSL/TLS协议进行了加密处理。（TLS实际就是SSL3.0之后的后续版本）  

http和https使用连接方式不同，默认端口也不一样，http是80，https是443。



##  TCP的连接

- 三次握手

<img src="/img/notes/net/1.png">

- 四次挥手

<img src="/img/notes/net/2.png">



## SSL认证过程

首先用户访问一个网站，tcp连接建立完成之后。

客户端像服务端发送报文，服务端用其证书进行回应。

用户接收后就确认了是可以访问的网站，这时候客户端从证书中提取公钥并生成一个主秘钥MS，客户端使用公钥对其进行加密，发送给服务器。

服务器用私钥进行解密得到主秘钥MS，之后信息传输便通过主秘钥进行。



## IO和NIO

  NIO即New IO，这个库是在JDK1.4中才引入的。NIO和IO有相同的作用和目的，但实现方式不同，NIO主要用到的是块，所以NIO的效率要比IO高很多。在Java API中提供了两套NIO，一套是针对标准输入输出NIO，另一套就是网络编程NIO。

| **IO** | **NIO**  |
| ------ | -------- |
| 面向流 | 面向缓冲 |
| 阻塞IO | 非阻塞IO |
| 无     | 选择器   |

 传统的socket IO中，需要为每个连接创建一个线程，当并发的连接数量非常巨大时，线程所占用的栈内存和CPU线程切换的开销将非常巨大。使用NIO，不再需要为每个线程创建单独的线程，可以用一个含有限数量线程的线程池，甚至一个线程来为任意数量的连接服务。由于线程数量小于连接数量，所以每个线程进行IO操作时就不能阻塞，如果阻塞的话，有些连接就得不到处理，NIO提供了这种非阻塞的能力。

   这种服务方式跟传统的区别有两个：

1、增加了一个角色，要有一个专门负责收集客人需求的人。NIO里对应的就是Selector。

2、由阻塞服务方式改为非阻塞服务了，客人吃着的时候服务员不用一直侯在客人旁边了。传统的IO操作，比如read()，当没有数据可读的时候，线程一直阻塞被占用，直到数据到来。NIO中没有数据可读时，read()会立即返回0，线程不会阻塞。

   NIO中，客户端创建一个连接后，先要将连接注册到Selector，相当于客人进入餐厅后，告诉前台你要用餐，前台会告诉你你的桌号是几号，然后你就可能到那张桌子坐下了，SelectionKey就是桌号。当某一桌需要服务时，前台就记录哪一桌需要什么服务，比如1号桌要点菜，2号桌要结帐，服务员从前台取一条记录，根据记录提供服务，完了再来取下一条。这样服务的时间就被最有效的利用起来了。





## NAT

NAT（Network Address Translation，网络地址转换）是1994年提出的，其当在专用网内部的一些主机本来已经分配到了本地IP地址（即仅在本专用网内使用的专用地址），但现在又想和因特网上的主机通信（并不需要加密）时，可使用NAT方法。每个NAT设备负责维护一个包含本地IP、端口和外网IP、端口的映射表。所有使用本地地址的主机在和外界通信时，都要在NAT路由器上将其本地地址转换成全球IP地址，才能和因特网连接。

NAT的实现方式有如下三种，即：

1. 静态转换(Static NAT)：IP地址对是**一对一**的，是不改变的。比如公司下班都开自己车回家，就是自己只能开自己车，是一对一关系；
2. 动态转换(Dynamic NAT)：IP地址的对应关系是不确定的，而是随机的，所有被授权访问互联网的私有地址可随机转换为任何指定的合法的外部IP地址。（内部网络同时访问Internet的主机数少于配置的合法地址中的IP个数时适用）。公司下班都骑共享单车，共享单车并不是一个人规定了只能骑哪一个的，每个人都随机骑一个，是可以改变的，是多对多关系；
3. 端口多路复用(Port NAT)：改变外出数据包的源端口并进行端口转换，即端口地址转换。采用端口多路复用方式，内部网络的所有主机均可共享一个合法外部IP地址实现对Internet的访问，从而可以最大限度地节约IP地址资源。同时，又可隐藏网络内部的所有主机，有效避免来自internet的攻击。因此，目前网络中应用最多的就是端口多路复用方式。







## Windows10 [远程桌面连接](https://baike.baidu.com/item/远程桌面连接/669361)

前提是对方已经开启了远程连接功能（可百度）。

按住 win+R   输入 mstsc   输入对应的IP地址，输入对方的Windows密码即可连接到对应的电脑。

注意：

远程桌面连接默认使用3389端口，如果想修改默认的端口，需运行`regedit`进入注册表，修改`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\Tds\tcp`和`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp`的`PortNumber`键值即可。

修改时要注意使用的是十进制还是十六进制方式。

修改端口后，在远程输入IP时，就要显式指定端口号，形如`ip:port`。

若使用IPV6地址进行远程，IPV6地址必须使用中括号，例如`[2001:da8:214:1086:747c:abcd:efgh:1c6a]:22`。如果不修改端口，IPV6地址可以不加中括号。




















References
----------

- <https://www.cnblogs.com/syfwhu/p/5219814.html>
- <https://zhuanlan.zhihu.com/p/72616216>













