## Linux

Linux使用场景大多是作为服务器使用性能相对更好

1 一切皆文件

2 根目录 /，所有文件都在这个目录下

当你有root权限且执行 `rm -rf /` 就是删除所有文件（-r 递归删除 -f强制删除 ）

### 基础命令

`man` 当对于命令不熟悉的时候可以使用该命令来进行获取帮助 man ls

`ls` 列出目录 -a 显示所有文件包括隐藏文件 -l 列出文件属性

`cd` 切换目录命令

`cd ..` 返回上一级目录

`cp /user/old_file /user/new_file` 复制文件 到一个地方

`mv /user/old_file /user/new_file` 移动文件 到一个地方

`pwd` 展示当前所在目录

`mkdir` 创建文件夹 mkdir test

`touch` 创建文件 touch test.txt

`tar -zxvf` 解压

`tar -zcvf` 压缩

`df` 对应文件所占磁盘使用情况

`du` 磁盘空间使用情况

`ps` 查看当前系统中正在执行的各种进程的信息！ps -aux 查看所有进程信息

~~~
-a 显示当前终端运行的所有的进程信息
-u 以用户的信息显示进程	
-x 显示后台运行进程的参数！

ps -ef：可以查看到父进程的信息
~~~

`kill -9` 杀掉进程 kill -9 进程的id



`systemctl ` 提供了一组子命令来管理单个的 unit，其命令格式为: `systemctl [command] [unit]`

~~~
command 主要有：

start：立刻启动后面接的 unit。

stop：立刻关闭后面接的 unit。

restart：立刻关闭后启动后面接的 unit，亦即执行 stop 再 start 的意思。

reload：不关闭 unit 的情况下，重新载入配置文件，让设置生效。

enable：设置下次开机时，后面接的 unit 会被启动。

disable：设置下次开机时，后面接的 unit 不会被启动。
~~~





### 文件属性

Linux系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。为了保护系统的安全性，Linux系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。

在Linux中我们可以使用`ll`或者`ls -l`命令来显示一个文件的属性以及文件所属的用户和组

第一个属性的意义

- 当为[ **d** ]则是目录

- 当为[ **-** ]则是文件；

- 若是[ **l** ]则表示为链接文档（link file）；

- 若是[ **b** ]则表示为装置文件里面的可供储存的接口设备（可随机存取装置）；

- 若是[ **c** ]则表示为装置文件里面的串行端口设备，例如键盘、鼠标（一次性读取装置）。

  

  每个文件的属性由左边第一部分的10个字符来确定（如下图）

![img](\img\notes\linux\1.jpg)

第0位确定文件类型，第1-3位确定属主（该文件的所有者）拥有该文件的权限。第4-6位确定属组（所有者的同组用户）拥有该文件的权限，第7-9位确定其他用户拥有该文件的权限。



### 文件查看

`cat` 由第一行开始显示文件内容

`tac` 从最后一行开始显示，可以看出tac是cat倒着写！

`head`只看头几行 通过 -n 参数来控制显示几行！ head -n 20 cs.txt

`tail` 只看尾巴几行 -n 参数 要查看几行！

`more` 一页一页地显示文件内容，带余下内容的（空格代表翻页，enter 代表向下看一行，:f 行号）

`less` 与 `more`类似，但是比 more 更好的是，它可以往前翻页！（空格翻页，pageDown，pageUp键代表翻动页面！退出 q 命令，查找字符串 / 要查询的字符向下查询，向上查询使用 ? 要查询的字符串，n 继续搜寻下一个，N向上寻找！）



### 文件编辑

使用vim操作，vim分为三种模式，`命令模式` `输入模式` `底行模式`



**命令模式**：刚刚启动就会进入命令模式

输入 `x` 删除光标所处的字符

输入 `i` 进入输入模式 

输入 `：` 进入底行模式



**输入模式**：即正常编辑文件即可（只不过是需要通过键盘来编辑）

- **字符按键以及Shift组合**，输入字符
- **ENTER**，回车键，换行
- **BACK SPACE**，退格键，删除光标前一个字符
- **DEL**，删除键，删除光标后一个字符
- **方向键**，在文本中移动光标
- **HOME**/**END**，移动光标到行首/行尾
- **Page Up**/**Page Down**，上/下翻页
- **Insert**，切换光标为输入/替换模式，光标将变成竖线/下划线

输入 `Esc` 可退出输入模式（退出之后自动回到命令模式）



**底行模式**：

输入 `:` 进入底行模式之后直接输入下面命令可以进行相关操作

`q` 退出程序

`wq` 保存退出

`q!` 强制退出不存储

输入 `Esc` 可退出底行模式（退出之后自动回到命令模式）



### 账号管理



> 添加账号 useradd

```text
useradd 选项 用户名
```

参数说明：

- 选项 :

- - -c comment 指定一段注释性描述。
  - -d 目录 指定用户主目录，如果此目录不存在，则同时使用-m选项，可以创建主目录。
  - -g 用户组 指定用户所属的用户组。
  - -G 用户组，用户组 指定用户所属的附加组。
  - -m　使用者目录如不存在则自动建立。
  - -s Shell文件 指定用户的登录Shell。
  - -u 用户号 指定用户的用户号，如果同时有-o选项，则可以重复使用其他用户的标识号。

- 用户名 :

- - 指定新账号的登录名。



> Linux下如何切换用户

1.切换用户的命令为：su username 【username是你的用户名哦】

2.从普通用户切换到root用户，还可以使用命令：sudo su

3.在终端输入exit或logout或使用快捷方式ctrl+d，可以退回到原来用户，其实ctrl+d也是执行的exit命令

4.在切换用户时，如果想在切换用户之后使用新用户的工作环境，可以在su和username之间加-，例如：【su - root】

$表示普通用户

\#表示超级用户，也就是root用户



> 删除帐号

如果一个用户的账号不再使用，可以从系统中删除。

删除用户账号就是要将/etc/passwd等系统文件中的该用户记录删除，必要时还删除用户的主目录。

删除一个已有的用户账号使用userdel命令，其格式如下：

```text
userdel 选项 用户名
```

常用的选项是 **-r**，它的作用是把用户的主目录一起删除。



> 修改帐号

修改用户账号就是根据实际情况更改用户的有关属性，如用户号、主目录、用户组、登录Shell等。

修改已有用户的信息使用usermod命令，其格式如下：

```text
usermod 选项 用户名
```

常用的选项包括-c, -d, -m, -g, -G, -s, -u以及-o等，这些选项的意义与useradd命令中的选项一样，可以为用户指定新的资源值。

例如：

```text
# usermod -s /bin/ksh -d /home/z –g developer kuangshen
```

此命令将用户kuangshen的登录Shell修改为ksh，主目录改为/home/z，用户组改为developer。



> 用户口令的管理

用户管理的一项重要内容是用户口令的管理。用户账号刚创建时没有口令，但是被系统锁定，无法使用，必须为其指定口令后才可以使用，即使是指定空口令。

指定和修改用户口令的Shell命令是passwd。超级用户可以为自己和其他用户指定口令，普通用户只能用它修改自己的口令。

命令的格式为：

```text
passwd 选项 用户名
```

可使用的选项：

- -l 锁定口令，即禁用账号。
- -u 口令解锁。
- -d 使账号无口令。
- -f 强迫用户下次登录时修改口令。

如果默认用户名，则修改当前用户的口令。



### 关机

不管是重启系统还是关闭系统，首先要运行 **sync** 命令，把内存中的数据写到磁盘中

~~~
sync # 将数据由内存同步到硬盘中

shutdown # 关机指令，你可以 man shutdown 来看一下帮助文档。例如你可以运行如下命令关机:

shutdown -h 10 # 这个命令告诉大家，计算机将在10分钟后关机

shutdown -h now # 立马关机

shutdown -h 20:25 # 系统会在今天20:25关机

shutdown -h +10 # 十分钟后关机

shutdown -r now # 系统立马重启

shutdown -r +10 # 系统十分钟后重启

reboot # 就是重启，等同于 shutdown -r now

half # 关闭系统，等同于shutdown -h now 和 poweroff
~~~



### 防火墙

```
# 查看firewall服务状态
systemctl status firewalld

# 开启、重启、关闭、firewalld.service服务
# 开启
service firewalld start
# 重启
service firewalld restart
# 关闭
service firewalld stop

# 查看防火墙规则
firewall-cmd --list-all    # 查看全部信息
firewall-cmd --list-ports  # 只看端口信息

# 开启端口
开端口命令：firewall-cmd --zone=public --add-port=80/tcp --permanent
重启防火墙：systemctl restart firewalld.service

命令含义：
--zone #作用域
--add-port=80/tcp  #添加端口，格式为：端口/通讯协议
--permanent   #永久生效，没有此参数重启后失效
```





### 排查CPU问题

~~~
top -c
1、使用 top -c 命令展示cpu使用情况，找到cpu占用最高的那个进程id(不要退出top,直接输入P(必须大写),让CPU利用率从大到小排列)

top -Hp 1584 
2、top -Hp 进程id ，显示一个进程的线程运行信息列表，然后找到cpu占用最高的那个线程id
H打印线程信息
p指定pid

printf "%x" 1592
3、printf "%x" 线程id 将对应的线程id转为十六进制(因为jstack使用的是十六进制查询的)

jstack 1584 | grep ‘0x638’ -C5 --color
4、jstack 进程id | grep 十六进制的线程id
~~~

